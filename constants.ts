import { FormData } from './types';

export const generateStrategyPrompt = (data: FormData): string => {
  // Helper to handle empty fields
  const v = (key: keyof FormData) => data[key] || "（未提供）";

  // The prompt template exactly matching the user's provided structure
  return `
**致模拟使用者 (产品经理)：**

本文件提供了基于经过优化的、可复用的深度研究提示词 (Prompt) 模板。原始请求是针对特定车型（广汽传祺向往S7）的深度分析，现已将其重构为一个通用的、交互式的战略分析工具。

您 (产品经理) 的任务是完成【第一部分】的输入。一旦完成，将【第一部分】、【第二部分】和【第三部分】组合并提交给AI模型，即可启动一个与原始请求同样深度的、定制化的7步战略分析。

---

# 【第一部分】：交互式策略定义模块 (ISDM)

产品经理操作指南：请扮演您所负责产品的战略负责人。精准、完整地填写以下两个表格中的【您的输入】列。AI将使用这些变量作为其后续所有分析的核心依据。

**[表1: 核心产品与目标定义]**

| 变量 | 描述 | 您的输入 |
| :--- | :--- | :--- |
| {{产品名称}} | 本品的全名（含年款）。 | ${v('productName')} |
| {{产品类型}} | 细分市场/定位。 | ${v('productType')} |
| {{价格区间}} | 官方上市指导价范围。 | ${v('priceRange')} |
| {{实际价格}} | 当前终端有效/优惠后价格。 | ${v('actualPrice')} |
| {{上市日期}} | 市场投放日期。 | ${v('launchDate')} |
| {{数据截止日}} | 本次分析的"当前日期"。 | ${v('dataCutoff')} |
| {{销量目标}} | 期望的月度稳定销量目标。 | ${v('salesTarget')} |
| {{核心卖点}} | 上市时定义的3-5个关键卖点(KSP)。 | ${v('coreSellingPoints')} |
| {{内部系统_1}} | 关键自研技术（如座舱）。 | ${v('cockpitSystem')} |
| {{内部系统_2}} | 关键自研/供应商技术（如智驾）。 | ${v('smartDrivingSystem')} |
| {{能源形式}} | 能源类型约束 (PHEV / EREV)。 | ${v('energyType')} |
| {{市场价格区间}} | 市场分析所关注的价格范围。 | ${v('marketSegment')} |


**[表2: 竞争矩阵定义]**

| 变量 | 竞品类型 | 您的输入 |
| :--- | :--- | :--- |
| {{定位对标_1}} | 定位对标竞品 1 (直接"意向"或"渴望"的对手) | ${v('comp1')} |
| {{定位对标_2}} | 定位对标竞品 2 | ${v('comp2')} |
| {{价格重叠_1}} | 价格重叠竞品 1 (同价位区间的核心对手) | ${v('priceComp1')} |
| {{价格重叠_2}} | 价格重叠竞品 2 | ${v('priceComp2')} |
| {{价格重叠_3}} | 价格重叠竞品 3 | ${v('priceOverlap1')} |
| {{价格重叠_4}} | 价格重叠竞品 4 (如：新兴威胁) | ${v('priceOverlap2')} |
| {{高价位标杆_1}} | 高价位标杆 1 (价格高于本品但销量高) | ${v('highPrice1')} |
| {{高价位标杆_2}} | 高价位标杆 2 | ${v('highPrice2')} |

---

# 【第二部分】：通用化七步战略分析引擎

**AI执行指令：** 您将扮演一个由行业分析专家和产品策略师组成的团队。您的任务是严格执行以下7步分析框架，并且使用【第一部分】中定义的变量。您必须遵循指定的数据源优先级，并保持专业、数据驱动的分析口吻。

## 1. 看市场 (Market Analysis) - [全面深入]

*   **任务：** 分析 {{市场价格区间}} 价格区间内，{{产品类型}} 市场。分析必须严格聚焦于 {{能源形式}} 细分市场（排除纯电BEV）。
*   **数据与时间：** 使用截止到 {{数据截止日}} 的最新行业数据（如：中汽数据、乘联会、懂车帝/汽车之家销量榜）。
*   **分析：** 详细阐述该细分市场的总容量、同比增长趋势，以及当前的市场竞争格局（Top 5 玩家及其份额）。
*   **洞察生成：** 正在塑造这一特定细分市场的新兴主题、消费者情绪和市场动态是什么？

## 2. 看用户 (User Persona) - [全面深入]

*   **任务1：目标用户 vs. 实际用户：**
    1.  首先，基于 【第一部分】 中定义的 {{核心卖点}} 、{{产品类型}} 和 {{价格区间}}，构建本品上市时所瞄准的"目标用户画像"。
    2.  其次，使用真实世界用户数据（如：懂车帝/汽车之家论坛、社交媒体），分析从 {{上市日期}} 到 {{数据截止日}} 期间，{{产品名称}} 的"实际购买用户画像"。
    3.  最后，明确识别并深入分析"目标"与"实际"用户之间的"画像偏差"。我们是否卖给了我们预期的客户？差异点在哪里？
*   **任务2：竞品用户对比：**
    *   深入对比分析 {{产品名称}} 与其核心竞品（{{价格重叠_1}}、{{价格重叠_2}}、{{价格重叠_3}}、{{价格重叠_4}}）的实际车主画像差异。
    *   **洞察生成：** 在人口统计学、心理特征和"待办任务"(Jobs-to-be-Done)方面，导致用户选择 {{价格重叠_1}} 而不是 {{产品名称}} 的关键差异是什么？

## 3. 看用户 (User Scenarios & Pain Points) - [全面深入]

*   **任务：** 基于 {{产品名称}} 的真实车主反馈（论坛、社交媒体、专业长测报告），分析其核心用车场景。
*   **焦点：** 挖掘关键的、未被满足的"痛点" (Pain Points)。必须特别关注：
    1.  {{内部系统_1}} (座舱) 的真实口碑：是否直观？是否在卡顿？人机交互(HMI)是否合理？
    2.  {{内部系统_2}} (智驾) 的真实口碑：用户是否信任它？它是一个"惊喜"功能，还是一个"噱头"？实际可用性如何？
*   **洞察生成：** 此步骤为 **[第6步]** 中的定量数据提供定性的"为什么"。将用户报告的"挫折" 与 **** 中的"战败原因"直接关联。

## 4. 看竞争 (Competitor Identification) - [全面深入]

*   **任务：** 验证 **[表2: 竞争矩阵定义]** 中定义的竞争集合。
*   **分析：** 确认 {{定位对标_1}} 和 {{定位对标_2}} 是否仍是正确的定位对手。确认 {{价格重叠_1}} 到 {{价格重叠_4}} 是否是主要的某个价格重叠威胁。识别任何未在列表中但正在快速崛起的潜在威胁。

## 5. 看竞争 (Competitor Analysis) - [全面深入]

*   **任务1：高价位标杆分析：**
    *   分析 {{高价位标杆_1}} 和 {{高价位标杆_2}} 为何能够在其更高的价位上保持高销量。
    *   **洞察生成：** 他们的核心"护城河"是什么？是品牌（情感连接、认知），渠道（门店体验、销售能力），还是产品定义（例如，精准的"奶爸车"定位、"科技豪华"的融合）？这必须是价值主张分析，而不仅仅是功能列表对比。
*   **任务2：价格重叠竞品分析：**
    *   对 {{价格重叠_1}}、{{价格重叠_2}} 和 {{价格重叠_3}} 的成本控制、供应链策略和配置堆叠策略进行深入分析。
    *   **洞察生成：** {{价格重叠_2}} 是如何实现其极致"性价比（配）比"的？他们的平台化策略是什么？此分析将为 **【第三部分】** 的"打赢策略"提供依据。

## 6. 看自我 (Self Analysis) - [全面深入]

*   **任务1：定量业绩回顾：**
    *   分析 {{产品名称}} 从 {{上市日期}} 到 {{数据截止日}} 的市场表现。
    *   必须生成以下仪表盘（如果数据不可得，则基于行业分析进行估算）：

| 指标 | 3月 | 4月 | 5月 | 6月 | 7月 | 8月 | 9月 | 10月 | 11月 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 月度销量 (台) | | | | | | | | | |
| 平均售价 (ASP) | | | | | | | | | |
| SKU组合 % (高配) | | | | | | | | | |
| SKU组合 % (中配) | | | | | | | | | |
| SKU组合 % (低配) | | | | | | | | | |
| {{内部系统_2}} 选装率 % | | | | | | | | | |

*   **任务2：战败/战胜分析 (Win/Loss Analysis)：**
    *   基于终端销售数据和 **[第3步]** 的用户反馈，生成一份明确的Win/Loss报告。
    *   "购买理由" (Wins)：促成交易的 Top 3-5 因素是什么？（例如："价格"、"空间"、"设计"、"{{能源形式}}"）。
    *   "否决理由" (Losses)：导致客户流失的 Top 3-5 因素是什么？（例如："品牌力"、"{{内部系统_1}} 卡顿"、"{{内部系统_2}} 体验不佳"、"渠道服务"）。
*   **高阶洞察生成：** 必须将 **[表3]** 的定量数据与Win/Loss的定性分析进行交叉验证。
    *   *(AI思考示例)*：如果 "Win"理由是"高阶智驾 ({{内部系统_2}})"，但 **[表3]** 中的"选装率 %"低于10%，这表明存在严重错配。该功能是一个KSP（关键卖点），但该功能的打包方式或定价策略却是一个Loss（战败点）。这是制定 MY2026 路线图的主要依据。

## 7. 看技术 (Tech Trends) - [深度]

*   **任务：** 分析 2026-2027 年可落地、且能形成"代差"优势的，与 {{能源形式}} {{产品类型}} 相关的技术。
*   **焦点：** 必须分析以下几个关键类别：
    1.  **平台/动力总成：** 适用于 {{能源形式}} 的 800V 平台（对充电、效率的影响）。
    2.  **ADAS/AD：** 下一代智驾方案（例如，{{内部系统_2}} 供应商的演进、向"端到端"大模型的转变）。
    3.  **座舱/HMI：** AI大模型与 {{内部系统_1}} 的深度融合（超越语音助手，实现主动式、Agent化服务）。
    4.  **制造/成本：** CTC（电芯到底盘）或其他平台级集成技术，对成本、空间和安全的革命性影响。
*   **洞察生成：** 对于 **[第2步]** 中识别出的实际用户画像而言，上述哪项技术趋势提供了最大的成本效益和市场营销的"惊喜"因子？

---

# 【第三部分】：综合战略交付成果

**AI执行指令：** 基于以上7步深度分析，您必须生成以下三个核心交付成果，作为报告的最终结论和行动方案。

## 1. 核心战略问题回答

*   **市场定位裁决：** {{产品名称}} 当前的 {{价格区间}}（下探至 {{实际价格}}）是一个正确的"打赢"策略，还是一个暂时的"错位竞争"策略？基于分析，要实现 {{销量目标}}，所必需的价格点和价值主张应该是什么？
*   **KSP 有效性评估：** 上市时定义的 {{核心卖点}} 对 **[第2步]** 中分析的实际用户群是否有效？或者，这些用户是否只关心"大空间 + {{能源形式}} + 低价格"？请提供数据支持的明确结论。

## 2. "Beat-Them" 竞品策略

*   **任务：** 生成以下行动计划表。

| 竞品 | 它们的核心优势 (源自第5步) | 我们的"打赢"产品策略 | 我们的"打赢"定价策略 | 我们的"打赢"传播策略 |
| :--- | :--- | :--- | :--- | :--- |
| {{价格重叠_1}} | [AI分析填写] | [例如：增加功能X] | [例如：拉平拥车成本] | [例如：主打安全优势] |
| {{价格重叠_2}} | [AI分析填写] | | [例如：保持价差，但赠送服务] | [例如：攻击其廉价感] |
| {{价格重叠_3}} | [AI分析填写] | [例如：优化 {{内部系统_1}}] | [例如：提供0息金融] | [例如：聚焦家庭场景] |
| {{价格重叠_4}} | [AI分析填写] | [例如：突显内部空间] | [例如：捆绑配件包] | [例如：强调品牌传承] |

## 3. 产品迭代路线图建议 (Roadmap)

*   **任务：** 基于全部7个步骤的分析，为实现 {{销量目标}} 提供一个清晰、可执行的产品路线图。这必须是最终的行动计划。
*   **A) {{产品名称}} MY2026 (短期改款/年款)：**
    *   **SKU 与配置：** 需要立即增加（基于"Losses"）、删除（基于低选装率）或调整（例如，将 {{内部系统_2}} 下放）哪些配置？
    *   *(AI思考链)*：此路线图必须解决 **[第6步]** (Win/Loss) 和 **[第3步]** (Pain Points) 中发现的问题。这是对市场的被动反应和快速修正。
    *   **定价：** 价格应保持、继续下探，还是稳定后提升配置？请论证。
*   **B) MY2027 (下一代车型定义)：**
    *   *(AI思考链)*：此路线图必须解决 **[第7步]** (Tech Trends) 和 **[第5步]** (Competitor Moats) 中发现的趋势。这是对市场的主动预判和建立"代差"优势。
    *   **战略选择：** 必须做出明确建议，我们应追求：
        1.  **垂直换代：** 推出现有的、下一代 {{产品名称}}。
        2.  **侧翼包抄（下探）：** 推出一款更小、更低成本的"S6"类车型，以实现规模。
        3.  **侧翼包抄（上攻）：** 推出一款更大、更高价值的"S8"类车型，以提升品牌。
    *   请提供一个明确的建议：哪条路径（或组合）最有可能持续实现 {{销量目标}}？

---

请生成一份结构清晰、Markdown 格式的战略分析报告。
`;
};
