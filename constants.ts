import { FormData } from './types';

export const generateStrategyPrompt = (data: FormData): string => {
  const v = (key: keyof FormData) => data[key] || "";

  return `
**AI执行指令：**
您将扮演一个由行业分析专家和产品策略师组成的团队。您的任务是基于以下【产品与竞争定义】，严格执行“通用化七步战略分析”，并最终生成“综合战略交付成果”。您必须遵循指定的数据源优先级，并保持专业、数据驱动的分析口吻。

---

# 【输入背景：产品与竞争定义】
*   **分析主体**: ${v('productName')} (${v('productType')})
*   **价格定位**: 官方指导价 ${v('priceRange')}，终端价 ${v('actualPrice')}，目标月销 ${v('salesTarget')}。
*   **核心属性**: ${v('energyType')} 能源，主打 ${v('coreSellingPoints')}。
*   **关键技术**: ${v('cockpitSystem')}，${v('smartDrivingSystem')}。
*   **竞争对手**:
    *   核心对标: ${v('comp1')}, ${v('comp2')}
    *   价格重叠: ${v('priceComp1')}, ${v('priceComp2')}, ${v('priceComp3')}, ${v('priceComp4')}
    *   高价标杆: ${v('highPrice1')}, ${v('highPrice2')}
*   **时间范围**: 上市日期 ${v('launchDate')}，数据截止至 ${v('dataCutoff')}。
*   **市场细分**: ${v('marketSegment')}

---

# 【第一阶段】：通用化七步战略分析引擎

**1. 看市场 (Market Analysis) - [全面深入]**
*   **任务：** 分析 ${v('marketSegment')} 价格区间、 ${v('productType')} 市场。分析必须严格聚焦于 ${v('energyType')} 细分市场 (排除纯电BEV)。
*   **数据与时间：** 使用截止到 ${v('dataCutoff')} 的最新行业数据（如：中汽数据、乘联会、懂车帝/汽车之家销量榜）。
*   **分析：** 详细阐述该细分市场的总容量、同比增长趋势，以及当前的 Top 5 玩家及其份额。
*   **洞察生成：** 正在塑造这一特定细分市场的新兴主题、消费者情绪和市场动态是什么？

**2. 看用户 (User Persona) - [全面深入]**
*   **任务1：目标用户 vs. 实际用户：**
    1.  首先，基于 ${v('coreSellingPoints')}、${v('productType')} 和 ${v('priceRange')}，构建本品上市时所瞄准的“目标用户画像”。
    2.  其次，使用真实世界用户数据（如：懂车帝/汽车之家论坛、社交媒体），分析从 ${v('launchDate')} 到 ${v('dataCutoff')} 期间，${v('productName')} 的“实际购买用户画像”。
    3.  最后，明确识别并深入分析“目标”与“实际”用户之间的“画像偏差”。我们是否卖给了我们预期的客户？差异点在哪里？
*   **任务2：竞品用户对比：**
    *   深入对比分析 ${v('productName')} 与其核心竞品（${v('priceComp1')}、${v('priceComp2')}、${v('priceComp3')}、${v('priceComp4')}）的实际车主画像差异。
    *   **洞察生成：** 在人口统计学、心理特征和“待办任务”(Jobs-to-be-Done)方面，导致用户选择 ${v('priceComp1')} 而不是 ${v('productName')} 的关键差异是什么？

**3. 看用户 (User Scenarios & Pain Points) - [全面深入]**
*   **任务：** 基于 ${v('productName')} 的真实车主反馈（论坛、社交媒体、专业长测报告），分析其核心用车场景。
*   **焦点：** 挖掘关键的、未被满足的“痛点” (Pain Points)。必须特别关注：
    1.  ${v('cockpitSystem')}  的真实口碑：用户口是否喜欢它，有什么优缺点？
    2.  ${v('smartDrivingSystem')}  的真实口碑：用户是否信任它？它是一个“惊喜”功能，还是一个“噱头”？实际可用性如何？
*   **洞察生成：** 此步骤为 [第6步] 中的定量数据提供定性的“为什么”。将用户报告的“挫折”与 **** 中的“战败原因”直接关联。

**4. 看竞争 (Competitor Identification) - [全面深入]**
*   **任务：** 验证竞争集合。
*   **分析：** 确认 ${v('comp1')} 和 ${v('comp2')} 是否仍是正确的定位对手。确认 ${v('priceComp1')} 到 ${v('priceComp4')} 是否是主要的价格重叠威胁。识别任何未在列表中但正在快速崛起的潜在威胁。

**5. 看竞争 (Competitor Analysis) - [全面深入]**
*   **任务1：高价位标杆分析：**
    *   分析 ${v('highPrice1')} 和 ${v('highPrice2')} 为何能够在其更高的价位上保持高销量。
    *   **洞察生成：** 他们的核心“护城河”是什么？是品牌（情感连接、认知），渠道（门店体验、销售能力），还是产品定义（例如，精准的“奶爸车”定位、“科技豪华”的融合）？这必须是价值主张分析，而不仅仅是功能列表对比。
*   **任务2：价格重叠竞品分析：**
    *   对 ${v('priceComp1')}、${v('priceComp2')} 和 ${v('priceComp3')} 的成本控制、供应链策略和配置堆叠策略进行深入分析。
    *   **洞察生成：** ${v('priceComp2')}  是如何实现其极致“性价比” (配) 比“的？他们的平台化策略是什么？此分析将为 【第二阶段】 的“打赢策略”提供依据。

**6. 看自我 (Self Analysis) - [全面深入]**
*   **任务1：定量业绩回顾：**
    *   分析 ${v('productName')} 从 ${v('launchDate')} 到 ${v('dataCutoff')} 的市场表现。
    *   必须生成月度销量、ASP、SKU组合占比的分析表格（如果数据不可得，则基于行业分析进行估算）。
*   **任务2：战胜/战败分析 (Win/Loss Analysis)：**
    *   基于终端销售数据和 [第3步] 的用户反馈，生成一份明确的Win/Loss报告。
    *   “购买理由” (Wins)：促成交易的 Top 3-5 因素是什么？（例如：“价格”、“空间”、“设计”、《${v('energyType')}》）。
    *   “否决理由” (Losses)：导致客户流失的 Top 3-5 因素是什么？（例如：“品牌力”、“${v('cockpitSystem')} ”、“${v('smartDrivingSystem')} ”、“渠道服务”）。
*   **高阶洞察生成：** 必须将 [第3步] 的定量数据与Win/Loss的定性分析进行交叉验证。
    *   *(AI思考示例)：如果“Win”理由是“(${v('smartDrivingSystem')})”，但“带该配置的车型累计MIX %”低于10%，这表明存在严重错配。该功能是一个KSP（关键卖点），但该功能的打包方式或定价策略却是一个Loss（战败点）。这是制定后续产品路线图的主要依据。*

**7. 看技术 (Tech Trends) - [深度]**
*   **任务：** 分析未来 2 年可落地、且能形成“代差”优势的，与 ${v('energyType')} ${v('productType')} 相关的技术。
*   **焦点：** 必须分析以下几个关键类别：
    1.  平台/动力总成：适用于 ${v('energyType')} 的动总平台（如 800V、超快充电池等技术对充电、效率的影响）。
    2.  ADAS/AD：下一代智驾方案供应商的演进、向“端到端”大模型的转变）。
    3.  座舱/HMI：AI大模型与座舱的深度融合（超越语音助手，实现主动式、Agent化服务）。
    4.  制造/成本：CTC（电芯到底盘）或其他平台级集成技术，对成本、空间和安全的革命性影响。
*   **洞察生成：** 对于 [第2步] 中识别出的实际用户画像而言，上述哪项技术趋势提供了最大的成本效益和市场营销的“惊喜”因子？

---

# 【第二阶段】：综合战略交付成果

**AI执行指令：** 基于以上7步分析，你必须生成以下三个核心交付成果，作为报告的最终结论和行动方案。

**1. 核心战略问题回答**
*   **市场定位复核：** ${v('productName')} 当前的 ${v('priceRange')}（下探至 ${v('actualPrice')}）是一个正确的“打赢”策略，还是一个暂时的“错位竞争”策略？基于分析，要实现 ${v('salesTarget')}，所必需的价格点和价值主张应该是什么？
*   **KSP 有效性评估：** 上市时定义的 ${v('coreSellingPoints')} 对 [第2步] 中分析的实际用户群是否有效？或者，这些用户是否只关心“大空间 + ${v('energyType')} + 低价格”？请提供数据支持的明确结论。

**2. “Beat-Them” 竞品策略**
*   **任务：** 生成以下行动计划表。

**[表4：针对核心竞品的“打赢”策略行动表]**
| 竞品 | 它们的核心优势 (源自第5步) | 我们的“打赢”产品策略 | 我们的“打赢”定价策略 | 我们的“打赢”传播策略 |
| :--- | :--- | :--- | :--- | :--- |
| **${v('priceComp1')}** | [AI分析填写] | [例如：增加功能X] | [例如：拉平拥车成本] | [例如：主打安全优势] |
| **${v('priceComp2')}** | [AI分析填写] | ... | [例如：保持价差，但赠送服务] | [例如：攻击其廉价感] |
| **${v('priceComp3')}** | [AI分析填写] | [例如：优化 ${v('cockpitSystem')}] | [例如：提供0息金融] | [例如：聚焦家庭场景] |
| **${v('priceComp4')}** | [AI分析填写] | [例如：突显内部空间] | [例如：捆绑配件包] | [例如：强调品牌传承] |

**3. 产品迭代路线图建议 (Roadmap)**
*   **任务：** 基于全部7个步骤的分析，为实现 ${v('salesTarget')} 提供一个清晰、可执行的产品路线图。这必须是最终的行动计划。
*   **A) ${v('productName')} MY2026 (短期改款/年款)：**
    *   **SKU 与配置：** 需要立即增加（基于“Losses”）、删除（基于低选装率）或调整（例如，将 ${v('smartDrivingSystem')} 下放）哪些配置？
    *   *(AI思考链)：此路线图必须解决 [第6步] (Win/Loss) 和 [第3步] (Pain Points) 中发现的问题。这是对市场的被动反应和快速修正。*
    *   **定价：** 价格应保持、继续下探，还是稳定后提升配置？请论证。
*   **B) MY2027 (下一代车型定义)：**
    *   *(AI思考链)：此路线图必须解决 [第7步] (Tech Trends) 和 [第5步] (Competitor Moats) 中发现的趋势。这是对市场的主动预判和建立“代差”优势。*
    *   **战略选择：** 必须做出明确建议，我们应追求：
        1.  垂直换代：推出现有的、下一代 ${v('productName')}。
        2.  侧翼包抄 (下探)：推出一款更小、更低成本的“S6”类车型，以实现规模。
        3.  侧翼包抄 (上攻)：推出一款更大、更高价值的“S8”类车型，以提升品牌。
    *   请提供一个明确的建议：哪条路径（或组合）最有可能持续实现 ${v('salesTarget')}？

---

请生成一份结构清晰、**Markdown 格式**的深度战略分析报告。确保数据翔实，观点犀利。
`;
};